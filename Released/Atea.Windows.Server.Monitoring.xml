<?xml version="1.0" encoding="utf-8"?>
<ManagementPack SchemaVersion="2.0" ContentReadable="true" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Manifest>
    <Identity>
      <ID>Atea.Windows.Server.Monitoring</ID>
      <Version>1.0.3.8</Version>
    </Identity>
    <Name>Atea.Windows.Server.Monitoring</Name>
    <References>
      <Reference Alias="MSDL">
        <ID>Microsoft.SystemCenter.DataWarehouse.Library</ID>
        <Version>7.0.8427.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="SC">
        <ID>Microsoft.SystemCenter.Library</ID>
        <Version>7.0.8427.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="Windows">
        <ID>Microsoft.Windows.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
      <Reference Alias="System">
        <ID>System.Library</ID>
        <Version>7.5.8501.0</Version>
        <PublicKeyToken>31bf3856ad364e35</PublicKeyToken>
      </Reference>
    </References>
  </Manifest>
  <Monitoring>
    <Rules>
      <Rule ID="Atea.Windows.Server.Monitoring.DiskUsageGB" Target="Windows!Microsoft.Windows.LogicalDisk" Enabled="false" ConfirmDelivery="false" Remotable="true" Priority="Normal" DiscardLevel="100">
        <Category>PerformanceCollection</Category>
        <DataSources>
          <DataSource ID="DS" TypeID="Windows!Microsoft.Windows.TimedScript.PerformanceProvider">
            <IntervalSeconds>14400</IntervalSeconds>
            <SyncTime />
            <ScriptName>DiskUsageProbe.vbs</ScriptName>
            <Arguments>$Target/Property[Type="Windows!Microsoft.Windows.LogicalDevice"]/DeviceID$</Arguments>
            <ScriptBody><![CDATA[On Error Resume Next
CONST GB = 1073741824
 
Dim oAPI, oBag
Set oAPI = CreateObject("MOM.ScriptAPI")
Set oArgs = WScript.Arguments
drive = oArgs(0)
 
strComputer = "."
Set objWMIService = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
 
Set colLogicalDisk = objWMIService.ExecQuery("Select * from Win32_LogicalDisk Where DeviceID= '" & drive & "'")
 
For each objLogicalDisk in colLogicalDisk
diskUsedGB = ((objLogicalDisk.size - objLogicalDisk.freespace)/GB)
Next
 
Set oBag = oAPI.CreatePropertyBag()
Call oBag.AddValue("DiskUsed",diskUsedGB)
Call oAPI.Return(oBag)]]></ScriptBody>
            <TimeoutSeconds>300</TimeoutSeconds>
            <ObjectName>LogicalDisk</ObjectName>
            <CounterName>DiskUsedGB</CounterName>
            <InstanceName>$Target/Property[Type="Windows!Microsoft.Windows.LogicalDevice"]/DeviceID$</InstanceName>
            <Value>$Data/Property[@Name='DiskUsed']$</Value>
          </DataSource>
        </DataSources>
        <WriteActions>
          <WriteAction ID="CollectToDB" TypeID="SC!Microsoft.SystemCenter.CollectPerformanceData" />
          <WriteAction ID="CollectToDW" TypeID="MSDL!Microsoft.SystemCenter.DataWarehouse.PublishPerformanceData" />
        </WriteActions>
      </Rule>
    </Rules>
  </Monitoring>
  <LanguagePacks>
    <LanguagePack ID="ENU" IsDefault="true">
      <DisplayStrings>
        <DisplayString ElementID="Atea.Windows.Server.Monitoring.DiskUsageGB">
          <Name>Disk Usage (GB)</Name>
          <Description>Collects the server Disk Usage in GB</Description>
        </DisplayString>
        <DisplayString ElementID="Atea.Windows.Server.Monitoring">
          <Name>Atea Windows Server Monitoring</Name>
          <Description>Extends the core monitoring of Windows Servers.</Description>
        </DisplayString>
      </DisplayStrings>
      <KnowledgeArticles></KnowledgeArticles>
    </LanguagePack>
  </LanguagePacks>
</ManagementPack>